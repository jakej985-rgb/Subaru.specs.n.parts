<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SubaruParts.App.ViewModels"
             xmlns:models="clr-namespace:SubaruParts.Navigation.Models;assembly=SubaruParts.Navigation"
             xmlns:nav="clr-namespace:SubaruParts.Navigation;assembly=SubaruParts.Navigation"
             x:Class="SubaruParts.App.Pages.HomePage"
             Title="Home"
             BackgroundColor="{StaticResource OemBg}"
             Shell.NavBarIsVisible="False">

    <Grid>
        <!-- Optional Background Image (Carbon) - Commented out as requested -->
        <!-- <Image Source="carbon_bg.png" Aspect="AspectFill" Opacity="0.15" /> -->

        <Grid RowDefinitions="Auto, Auto, Auto, *, Auto" Padding="16,40,16,16" RowSpacing="16">

            <!-- 1. Inline Current Vehicle Row -->
            <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12" VerticalOptions="Center">
                <Label Text="Vehicle"
                       TextColor="{StaticResource OemMuted}"
                       VerticalOptions="Center"
                       FontAttributes="Bold"/>

                <Frame Grid.Column="1"
                       BackgroundColor="{StaticResource OemSurface}"
                       BorderColor="{StaticResource OemDivider}"
                       Padding="12,6"
                       CornerRadius="16"
                       HasShadow="False">
                    <Label Text="{Binding CurrentVehicleLabel}"
                           TextColor="{StaticResource OemText}"
                           LineBreakMode="TailTruncation"
                           VerticalOptions="Center"/>
                </Frame>

                <Button Grid.Column="2"
                        Text="Change"
                        Command="{Binding GoVehiclePickerCommand}"
                        Style="{StaticResource SegBtn}"
                        WidthRequest="80"
                        HeightRequest="36"
                        FontSize="12"/>
            </Grid>

            <!-- 2. Segmented Control -->
            <Grid Grid.Row="1" ColumnDefinitions="*,*,*,*" ColumnSpacing="8">
                <Button Grid.Column="0" Text="Browse" Command="{Binding SetSegmentCommand}" CommandParameter="Browse" Style="{StaticResource SegBtn}">
                    <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsBrowse}" Value="True">
                            <Setter Property="BackgroundColor" Value="{StaticResource OemAccent}" />
                            <Setter Property="TextColor" Value="White" />
                            <Setter Property="BorderColor" Value="{StaticResource OemAccent}" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>
                <Button Grid.Column="1" Text="Parts" Command="{Binding SetSegmentCommand}" CommandParameter="Parts" Style="{StaticResource SegBtn}">
                     <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsParts}" Value="True">
                            <Setter Property="BackgroundColor" Value="{StaticResource OemAccent}" />
                            <Setter Property="TextColor" Value="White" />
                            <Setter Property="BorderColor" Value="{StaticResource OemAccent}" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>
                <Button Grid.Column="2" Text="Specs" Command="{Binding SetSegmentCommand}" CommandParameter="Specs" Style="{StaticResource SegBtn}">
                     <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsSpecs}" Value="True">
                            <Setter Property="BackgroundColor" Value="{StaticResource OemAccent}" />
                            <Setter Property="TextColor" Value="White" />
                            <Setter Property="BorderColor" Value="{StaticResource OemAccent}" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>
                <Button Grid.Column="3" Text="Tools" Command="{Binding SetSegmentCommand}" CommandParameter="Tools" Style="{StaticResource SegBtn}">
                     <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsTools}" Value="True">
                            <Setter Property="BackgroundColor" Value="{StaticResource OemAccent}" />
                            <Setter Property="TextColor" Value="White" />
                            <Setter Property="BorderColor" Value="{StaticResource OemAccent}" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>
            </Grid>

            <!-- Segment Title (Optional, helps context) -->
            <Label Grid.Row="2" Text="{Binding SegmentTitle}"
                   TextColor="{StaticResource OemMuted}"
                   FontSize="14"
                   FontAttributes="Bold"
                   Margin="4,0,0,0"/>

            <!-- 3. Tiles Grid -->
            <CollectionView Grid.Row="3" ItemsSource="{Binding SegmentTiles}">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" HorizontalItemSpacing="12" VerticalItemSpacing="12" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:HomeTile">
                        <Grid>
                             <Frame BackgroundColor="{StaticResource OemSurface}"
                                   BorderColor="{StaticResource OemDivider}"
                                   CornerRadius="12"
                                   HasShadow="False"
                                   Padding="16">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HomeViewModel}}, Path=NavigateTileCommand}"
                                                          CommandParameter="{Binding Route}" />
                                </Frame.GestureRecognizers>
                                <VerticalStackLayout Spacing="8">
                                    <!-- Icon Placeholder (BoxView or Label if image missing) -->
                                    <!-- Using Label for icon name as placeholder since we don't have images -->
                                    <!-- <Image Source="{Binding Icon}" HeightRequest="32" WidthRequest="32" HorizontalOptions="Start" /> -->
                                    <Label Text="âŒ˜" FontSize="24" TextColor="{StaticResource OemAccent}" />

                                    <Label Text="{Binding Title}" TextColor="{StaticResource OemText}" FontAttributes="Bold" FontSize="16" LineBreakMode="TailTruncation" />
                                    <Label Text="{Binding Subtitle}" TextColor="{StaticResource OemMuted}" FontSize="12" LineBreakMode="TailTruncation" />
                                </VerticalStackLayout>
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- 4. Footer: Settings + Debug -->
            <StackLayout Grid.Row="4" Orientation="Horizontal" HorizontalOptions="Center" Spacing="20">
                <Button Text="Settings"
                        Command="{Binding NavCommand}"
                        CommandParameter="{x:Static nav:AppRoutes.Settings}"
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource OemMuted}"
                        FontSize="14"/>

                <Button Text="Route Audit"
                        Command="{Binding NavCommand}"
                        CommandParameter="{x:Static nav:AppRoutes.RouteAudit}"
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource OemMuted}"
                        FontSize="12"/>
            </StackLayout>

        </Grid>
    </Grid>
</ContentPage>
